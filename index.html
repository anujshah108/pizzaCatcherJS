<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>tracking.js - first tracking</title>
    <link rel="stylesheet" href="style.css">
    <script src="./build/tracking-min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>

<body>
  <div id='site'>
    <video id="webcam" autoplay="true" width="100%" autoplay></video>
    <!-- top right corner of screen is 0,0, bottom left is width,height -->
    <div id="snowZone"></div>
  </div>

    <script>
      var video = document.querySelector("#webcam");

      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;
      if (navigator.getUserMedia) {
          navigator.getUserMedia({
              video: true
          }, handleVideo, videoError);
      }

      function handleVideo(stream) {
          video.src = window.URL.createObjectURL(stream);
      }

      function videoError(e) {
          console.log(e)
      }


      tracking.ColorTracker.registerColor('pink', function(r, g, b) {
        if ((r > 180) && (g < 90 && g > 40) && (b < 160 && b > 80)) return true;
        return false;
      })
        const tracker = new tracking.ColorTracker(['pink']);
        // tracker.setInitialScale(2);
        // tracker.setStepSize(.5);
        // tracker.setEdgesDensity(0.1);
        let trackerX;
        let trackerY;
        tracking.track('#webcam', tracker);
        tracker.on('track', function(event) {
            event.data.forEach(function(rect) {
              trackerX = (900 - rect.x)
              trackerY = rect.y;
                // console.log('PINK', 'X: ', rect.x, 'Y: ', rect.y)
            });
        });


      function fallingSnow() {

          var $snowflakes = $(),
              qt = 1;

          for (var i = 0; i < qt; ++i) {
              var $snowflake = $('<img class="snowflakes" src ="pizza.png">');
              $snowflake.css({
                  'left': ($('#webcam').offset().left + Math.random() * $('#webcam').width()) + 'px',
                  'top': '0px'
              });
              // add this snowflake to the set of snowflakes
              $snowflakes = $snowflakes.add($snowflake);
          }
          $('#snowZone').prepend($snowflakes);
          // console.log($('.snowflakes').offset().left)
          // console.log($('.snowflakes').offset().top)
          $snowflakes.animate({
              top: "1000px"
          }, {
              duration: 4000,
              step: function(now, fx) {
                let pizzaX = $('.snowflakes').offset().left
                let pizzaY = $('.snowflakes').offset().top
                // console.log(pizzaX)
                // console.log(pizzaY, trackerY)
                if ((pizzaX < trackerX + 80 && pizzaX > trackerX -80) && (pizzaY < trackerY + 80 && pizzaY > trackerY -80)) {
                  $(this).remove()
                }
              },
              complete: function() {
                $(this).remove()
              }
          });
          // $('.snowflakes').remove()
      }

      var intervalToken = setInterval(fallingSnow, 3000)
    </script>
</body>

</html>
